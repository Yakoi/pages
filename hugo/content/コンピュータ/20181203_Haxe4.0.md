# Haxe 4.0

￼

<!-- @import "[TOC]" {cmd="toc" depthFrom=2 depthTo=4 orderedList=true} -->

<!-- code_chunk_output -->

1. [Haxe 4.0.0-preview.5](#haxe-400-preview5)
    1. [Release Notes](#release-notes)
    2. [New features:](#new-features)
    3. [Removals:](#removals)
    4. [Bugfixes:](#bugfixes)
    5. [Standard Library:](#standard-library)
2. [Haxe 4.0.0-preview.4](#haxe-400-preview4)
    1. [Release Notes](#release-notes-1)
    2. [New features:](#new-features-1)
    3. [General improvements and optimizations:](#general-improvements-and-optimizations)
    4. [Removals:](#removals-1)
    5. [Bugfixes:](#bugfixes-1)
    6. [Standard Library:](#standard-library-1)
3. [axe 4.0.0-preview.3](#axe-400-preview3)
    1. [Release Notes](#release-notes-2)
    2. [New features:](#new-features-2)
    3. [General improvements and optimizations:](#general-improvements-and-optimizations-1)
    4. [Removals:](#removals-2)
    5. [Deprecations:](#deprecations)
    6. [Bugfixes:](#bugfixes-2)

<!-- /code_chunk_output -->

### Haxe 4.0.0-preview.5
#### Release Notes

```
Dear Community,

On behalf of the Haxe Foundation, we are proud to announce the official release of the Haxe 4.0.0-preview.5! It is available along with the changelog at https://haxe.org/download.

As a preview release, it should not be considered stable. However, we appreciate anyone testing this version which will help us with the real Haxe 4 release. Please report any issues here:

https://github.com/HaxeFoundation/haxe/issues

Thank you very much for your help!
```



#### New features:

1. all : support Unicode strings properly on all targets
1. all : support for (key => value in e)syntax for key-value iterators
   キーと値を同時に取り出せるようになった。
1. all : added keyValueIterator to Map and its implementations
1. all : support loop-unrolling on for (i in 0...5) (#7365)
1. all : added support for write-mode @:op(a.b)
1. all : support inline call() and inline new expressions (#7425)
1. all : support @:using on type declarations (#7462)
1. all : support XML literal strings but require them to be macro-processed (#7438)
1. all : allow enum values without arguments as default function argument values (#7439)
1. lua : add -D lua-vanilla, which emits code with reduced functionality but no additional lib dependencies
1. General improvements and optimizations:
1. all : [breaking] reserved operator and overload as keywords (#7413)
1. all : made final on structure fields invariant (#7039)
1. all : [breaking] disallowed static variables that have no type-hint and expression (#6440)
1. all : added display/typeDefinition to display protocol (#7266)
1. all : fixed various display-related problems
1. all : made parser in display mode much more tolerant
1. all : allowed assigning [] where Mapis expected (#7426)
1. all : unified various parts of the String API across all targets
1. php : Optimized haxe.ds.Vector (VectorData is not Array anymore)
1. php : Optimized Map.copy() and Array.copy()
1. php : Optimized iterators of Map and native arrays.
1. php : Support native PHP generators. See php.Syntax.yield() and php.Generator
1. js : updated HTML externs
1. eval : improved object prototype field handling (#7393)
1. eval : optimized int switches (#7481)
1. eval : improved IntMap and StringMap performance
1. eval : improved performance of instance calls
#### Removals:

1. all : disallowed get_x/set_x property syntax, use get/set instead (#4699)
1. all : disallowed default values on interface variables (#4087)
1. all : disallowed implements Dynamic on non-extern classes (#6191)
1. all : warn about expressions in extern non-inline fields (#5898)
1. all : removed -D use-rtti-doc, always store documentation instead (#7493)
1. all : disallowed macro-in-macro calls (#7496)
1. js : removed jQuery and swfobject externs (#7494)
#### Bugfixes:

1. all : fix GC compacting too often in server mode
1. all : [breaking] function () { }(e) is no longer parsed as a call (#5854)
1. all : fixed various minor inlining issues
1. all : disallowed return null from Void-functions (#7198)
1. all : fixed various pattern matching problems
1. all : fixed compiler hang in display mode (#7236)
1. all : fixed the XML printer trimming CDATA content (#7454)
1. all : fixed invalid visibility unification with statics (#7527)
1. php : Escape $ in field names of anonymous objects (#7230)
1. php : Generate switch as if...else if...else... to avoid loose comparison (#7257)
1. cs : fixed bad evaluation order in structures (#7531)
1. eval : fixed various problems with the debugger
1. eval : fixed Vector.fromArrayCopy (#7492)
1. eval : fixed bad string conversions on invalid + operations
#### Standard Library:

1. all : [breaking] made Lambda functions return Array instead of List (#7097)
1. all : added haxe.iterators package
1. all : improved StringTools.lpad/rpad/htmlEscape implementation

￼

### Haxe 4.0.0-preview.4

#### Release Notes
```
Dear Community,
On behalf of the Haxe Foundation, we are proud to announce the official release of the Haxe 4.0.0-preview.4! It is available along with the changelog at https://haxe.org/download.
As a preview release, it should not be considered stable. However, we appreciate anyone testing this version which will help us with the real Haxe 4 release. Please report any issues here:
https://github.com/HaxeFoundation/haxe/issues.
Thank you very much for your help!
Improved compiler display services
Our focus for this release has been compiler display services. We implemented a new, JSON-RPC-based protocol which is utilized by the vshaxe Visual Studio Code Extension to provide a variety of new features:
Support for auto-import
Completion on override |
Completion for structure field names
Support for auto-generating structure declarations, functions, switches and more
Context-aware, sorted toplevel completion
Reference finding which explores modules that are not necessarily part of the compilation
Improved enum abstracts
Enum abstracts now get the treatment they deserve with a proper enum abstractsyntax. Furthermore, values can now be omitted if the enum abstract is defined over Int or String:
enum abstract MyEnum(String) { var MyValue; // implicit = "MyValue" } enum abstract MyOtherEnum(Int) { var MyValue0; // implicit = 0 var MyValue1; // implicit = 1 var MyValue5 = 5; var MyValue6; // implicit = 6 } 
Various syntactic improvements
extern is now recognized as a field-level modifier and can be used instead of @:extern
Metadata names can now use dots, e.g. @:haxe.json becomes a metadata entry named "haxe.json"
Structure fields now consistently allow var ?x and final ?x, meaning the same as @:optional var x
Type1 & Type2 is now a recognized syntax for intersection types. For the time being, it is only supported to merge structures (replacing the { >Type1, >Type2, } syntax) and for type parameter constraints (replacing T:(Type1, Type2) which has been removed from the language).
Lots of bugfixes
See the changelog for more!
```


#### New features:

1. all : added JSON-RPC-based display protocol
1. all : allow enum abstract syntax instead of @:enum abstract (#4282)
1. all : allow extern on fields instead of @:extern
1. all : support signature completion on incomplete structures (#5767)
1. all : support auto-numbering and auto-stringification in enum abstracts (#7139)
1. all : support Type1 & Type2intersection syntax for type parameter constraints and structures (#7127)
#### General improvements and optimizations:

1. all : reworked CLI usage/help output (#6862)
1. all : implemented for loop unrolling (#3784)
1. all : metadata can now use ., e.g. @:a.b. This is represented as a string (#3959)
1. all : [breaking] disallow static extensions on implicit this (#6036)
1. all : allow true and false expressions as type parameters (#6958)
1. all : improved display support in many areas
1. all : support override | completion
1. all : make display/references and display/toplevel actually work sometimes
1. all : allow var ?x and final ?xparsing in structures (#6947)
1. all : improved overall robustness of the parser in display mode
1. all : allow @:commutative on non-static abstract functions (#5599)
1. js : added externs for js.Date (#6855)
1. js : respect -D source-map flag to generate source maps in release builds
1. js : enums are now generated as objects instead of arrays (#6350)
1. eval : improved debugger, support conditional breakpoints
#### Removals:

1. all : moved haxe.remoting to hx3compat
1. js : moved js.XMLSocket to hx3compat
1. neko : moved neko.net to hx3compat
1. all : removed support for T:(A, B)constraint syntax
#### Bugfixes:

1. all : fixed various issues with diagnostics
1. all : fixed fields with default values for @:structInit classes (#5449)
1. all : fixed Null<T> inconsistency in if/ternary expressions (#6955)
1. all : fixed visibility check related to private constructors of sibling classes (#6957)
1. all : fixed @:generic naming (#6968)
1. all : fixed handling of type parameters in local functions (#6560)
1. all : fixed resolution order between untyped and type parameters (#7113)
1. all : fixed unification behavior in try/catch expressions (#7120)
1. all : fixed field type being lost for Int expressions on Float fields (#7132)
1. all : cleaned up inline handling (#7155)
1. display : fixed completion in packages starting with underscore (#5417)
1. php : fixed Reflect.callMethod with classes as first argument (#7106)
1. eval : fixed internal exception surfacing in some context calls (#7007)
1. eval : fixed Type.enumEq (#6710)
1. flash : fixed silently swallowing exceptions in getters/setters when invoked with Reflect methods (#5460, #6871)
#### Standard Library:

1. all : added resize to Array (#6869)
1. all : [breaking] removed return thisfrom some haxe.Http methods (#6980)



￼

### axe 4.0.0-preview.3


#### Release Notes

```
Dear Community,
On behalf of the Haxe Foundation, we are proud to announce the official release of the Haxe 4.0.0-preview.3! It is available along with the changelog at https://haxe.org/download.
As a preview release, it should not be considered stable. However, we appreciate anyone testing this version which will help us with the real Haxe 4 release. Please report any issues here:
https://github.com/HaxeFoundation/haxe/issues.
Thank you very much for your help!
The most important change of this preview release is the new function type syntax. It was proposed by Dan Korostelevand successfully passed through Haxe Evolution process.
The new syntax provides a natural way for declaring function types with support for argument names which allows to create more readable self-explaining code:
// no arguments () -> Void // single argument (name:String) -> Void // multiple (also, optional) arguments (name:String, ?age:Int) -> Void // unnamed arguments (Int, String) -> Bool // mixed arguments, why not (a:Int, ?String) -> Void 
While the old function type syntax is still supported, we would advise using the new one for writing new code.
Since this preview, the final keyword is allowed in anonymous structure syntax using class notation:
{ /** ordinary field */ var field1:Int; /** Immutable field */ final field2:String; } 
This release also makes a few steps towards replacing untyped code:
There are new js.Syntax.code(), php.Syntax.code() and other methods, which should be used for platform specific syntax that is not naturally achievable using Haxe syntax. The Syntax classe - unlike the untyped keyword - is type-safe and analyzer-friendly.
The JavaScript target got performance optimizations for its x.iterator() and Std.is(value, MyClass) calls. The first one improves iteration over Iterable<T>, the second one is compiled to plain value instanceof MyClass instead of a function call where possible.
SSL support was added to HTTP requests for the Python target.
The PHP target does not need to call Reflect.compareMethods() anymore. Starting from this preview any functions can be compared with the == operator, just like it is done for most of the other targets.
Of course, numerous other improvements and bugfixes were implemented. For more details, please refer to the changelog.
```


#### New features:

1. all : added new function type syntax ((a:Int, b:String)->Void) (#6645)
1. all : added column to StackItem.FilePos (#6665)
1. all : added -D warn-var-shadowing
1. all : added haxe.Log.formatOutput (#6738)
1. js : added js.Syntax class for generating unsupported JavaScript syntax in a type-safe analyzer-friendly way
1. js : added js.Map and js.Set and js.JsIterator extern definitions (ES6)
1. hl : added hl.Format.digest, use it for native Sha1/Md5
#### General improvements and optimizations:

1. all : made all non-warning/non-error compiler messages output to stdout (#4480)
1. all : make DCE keep constructor if any instance field is kept (#6690)
1. all : make final in structures use class notation
1. display : added this and super to toplevel completion (#6051)
1. php : implemented direct method comparison. No need to use Reflect.compareMethods()
1. php : added php.Syntax.code() instead of deprecated untyped __php__()(#6708)
1. php : added methods to php.Syntaxfor each php operator: ??, ?:, **etc. (#6708)
1. python : add ssl support for http requests
1. python : improve Sys.print(ln) code generation (#6184)
1. js : generate faster code for x.iterator() calls (#6669)
1. js : rework exception handling, added js.Lib.getOriginalException (#6713)
1. js : generate value instanceof MyClassinstead of Std.is(value, MyClass)(#6687)
1. js : use lazy getter for HaxeError.message instead of calling String(val) in the ctor (#6754)
#### Removals:

1. php : removed php.Syntax.binop()(#6708)
#### Deprecations:

1. php : deprecated support for untyped __php__, untyped __call__ etc. Use php.Syntax instead.
#### Bugfixes:

1. all : delay interface accessor generation properly (#6225, #6672)
1. all : fixed unbound variable error in anonymous functions (#6674)
1. all : fixed abstract @:to used when from is available in a specific case (#6751)
1. all : sys.Http: fix chunked encoding handling (#6763)
1. all : fix some invalid Json being accepted by haxe.format.JsonParser (#6734)
1. all : fixed haxe.format.JsonPrinter for instances of classes to make it produce consistent result across targets (#6801)
1. all : fixed autogenerated constructor for extending @:structInit classes (#6822, #6078)
1. js : fixed saving setter to tmp var before invocation (#6672)
1. lua : fix toString behavior in the case of -0 (#6652)
1. lua : properly bind field functions when passed as arguments (#6722)
1. php : don't fail on generating import aliases for classes with the similar names (#6680)
1. php : fixed Sys.environment() to also return variables set by Sys.putEnv()
1. php : fixed sys.net.Socket.bind()(#6693)
1. php : fixed appending "sqlite:" prefix to the names of files created by sys.db.Sqlite.open() (#6692)
1. php : made php.Lib.objectOfAssociativeArray() recursive (#6698)
1. php : fixed php error on parsing expressions like a == b == c (#6720)
1. php : fixed multiple file uploads in php.Web.parseMultiPart() (#4173)
1. php : fixed an issue with "Object" used as a class name for PHP 7.2 (it's a new keyword in php) (#6838)
1. eval : don't lose dynamic function inits from parent classes (#6660)
1. cs : fix order-dependent enum type parameter issue (#6016)


￼

### Haxe 4.0.0-preview.2


#### Release Notes

```
Dear Community,

On behalf of the Haxe Foundation I am proud to announce that Haxe 4.0.0-preview.2 is now officially released! It is available along with the changelog at https://haxe.org/download.

This release removes the old PHP target, which means Haxe is going to output only PHP7 from now on. Furthermore, we are removing some parts of the standard library. For easier transition, they are still available in this haxelib: https://lib.haxe.org/p/hx3compat/

The major new feature of this release is the addition of the final keyword, which can be used in place of var for class fields. For static fields, it behaves like var name(default, never). For instance fields, it allows assignment to the variable only from the class constructor. Further refinements and documentation will follow.

There have also been, of course, various bugfixes. We will make an effort to have monthly preview releases for the remainder for 2017, and then move on to RC releases once we are happy with where Haxe 4 is.

Please test your Haxe code with this version and let us know if you come across any problems at https://github.com/HaxeFoundation/haxe/issues.

Thank you for your support
```


#### New features:

1. all : added final keyword (#6596)
1. General improvements and optimizations:
1. all : replaced some occurrences of List with Array
1. all : changed haxe.xml.Fast to an abstract
1. all : improved optimization when comparing against null
1. all : added support for case var xsyntax and detect possible typos (#6608)
1. php : changed --php-prefix, --php-front and --php-lib to -D php-prefix=, -D php-front= and -D php-lib= respectively
#### Removals:

1. all : moved haxe.unit to hx3compat
1. all : moved haxe.web.Request to hx3compat
1. php : dropped php5 support; minimum supported php version is 7.0 now
#### Bugfixes:

1. all : fixed issue with various functions not being displayed in macro context (#6000)
1. all : fixed invalid static extension lookup on super (#3607)
1. all : fixed typing error when constructing enums with abstracts over functions (#6609)
1. all : fixed bug that skipped checking @:from typing in some cases (#6564)
1. all : fixed Int64 parsing of negative numbers that end in a zero (#5493)
1. all : fixed top-down inference when constructing enums (#6606)
1. eval : fixed bug with equality handling
1. eval : fixed issue with file creation not defaulting to binary
1. eval : fixed invalid override detection (#6583)
1. eval : fixed infinite recursion when printing arrays/vectors
1. cs/java : fixed DCE bug that would lose toString method of thrown objects
1. php/python : fixed some bit operators for Int32 (#5938)
1. php : fixed accessing static inline var via reflection (#6630)
1. php : fixed Math.min() and Math.max() for NAN on PHP 7.1.9 and 7.1.10
1. js : fixed js syntax error for value.iterator-- (#6637)
#### Standard Library:

1. macro : added haxe.display.Position and PositionTools.toRange (#6599)
1. all : moved List to haxe.ds (#6610)



￼

#### Haxe 4.0.0-preview.1

#### Release Notes

```
This is a Haxe 4 preview release for the Haxe Summit 2017 in Amsterdam.

As a preview release, it should not be considered stable and does, in fact, have some known issues. However, we appreciate anyone testing this version as it is going to ultimately help with the real Haxe 4 release. Please report issues at https://github.com/HaxeFoundation/haxe/issues.
```


#### New features:

1. all : reworked macro interpreter
1. all : added support for arrow functions
#### General improvements and optimizations:

1. js : improved generation of breakinside switch inside loops (#4964)
1. cs : improved generation of enum classes (#6119)
1. sys : the database parameter of Mysql.connect is now optional
1. js : updated jQuery extern (js.jquery.*) for jQuery 1.12.4 / 3.2.1 support.
1. Makefile : default Unix installation location $(INSTALL_DIR) changed from /usr to /usr/local.
1. Makefile : default Unix std location $(INSTALL_STD_DIR) changed from $(INSTALL_LIB_DIR)/std to $(INSTALL_DIR)/share/haxe/std.
#### Removals:

1. all : removed --eval command line argument
1. sys : SPOD (sys.db.Object, sys.db.Manager and friends) was moved into a separate library record-macros(https://github.com/HaxeFoundation/record-macros)
1. js : js.JQuery and js.SWFObject were moved into hx3compat library (https://github.com/HaxeFoundation/hx3compat),
1. it's recommended to use more modern js.jquery.JQuery and js.swfobject.SWFObject classes.
1. all : moved haxe.web.Dispatch into hx3compat library (https://github.com/HaxeFoundation/hx3compat).
#### Bugfixes:

1. php7: fix Reflect.field() for strings (#6276)
1. php7: fix @:enum abstract generation without -dce full (#6175)
1. php7: fix using enum constructor with arguments as a call argument (#6177)
1. php7: fix null property access (#6281)
1. php7: fix setting values in a map stored in another map (#6257)
1. php7: fix haxe.io.Input.readAll() with disabled analyzer optimizations (#6387)
1. php/php7: fixed accessing enum constructors on enum type stored to a variable (#6159)
1. php/php7: fix "cannot implement previously implemented interface" (#6208)
1. php: fix invoking functions stored in dynamic static vars (#6158)
1. php: fix field access on new MyClass()expressions wrapped in a cast(#6294)
#### Standard Library:

1. all : added EReg.escape (#5098)
1. all : BalancedTree implements haxe.Constraints.IMap` (#6231)