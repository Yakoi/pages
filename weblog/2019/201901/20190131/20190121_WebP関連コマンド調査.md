# WebP関連コマンド調査
 
<!-- @import "[TOC]" {cmd="toc" depthFrom=2 depthTo=3 orderedList=true} -->

<!-- code_chunk_output -->

1. [画質関連オプション](#画質関連オプション)
    1. [写真](#写真)
    2. [スクリーンショット](#スクリーンショット)
2. [プリセット](#プリセット)

<!-- /code_chunk_output -->
```cmd
cwebp [options] input_file -o output_file.webp
```


## 画質関連オプション
オプション無しで非可逆圧縮。-qで0-100の範囲で品質を調整。デフォルトは75。
可逆圧縮にするにはオプションに``-lossless``をつける。-qの意味は圧縮率になる。
さらに``-near_lossless int``なるオプションもある。直訳でほぼ無損失。
intが100の場合はそのままlosslessと同じ。0に近づくほど、若干損失させるみたい。可逆でも非可逆でもないような。

写真でサイズ比較してみる。

### 写真
|   #   |  圧縮の種類   |        オプション        | サイズ[kb] |      ヘルプの記載      |                     備考                     |
| :---: | ------------- | ------------------------ | ---------: | ---------------------- | -------------------------------------------- |
|   1   | (圧縮前のbmp) | -                        |  2,624.454 |                        |                                              |
|   2   | 非可逆圧縮    | -q 0                     |     27.820 |                        | 見れたもんじゃない                           |
|   3   | 非可逆圧縮    | -q 75                    |    146.826 | 非可逆圧縮のデフォルト |                                              |
|   4   | 非可逆圧縮    | -q 100                   |    435.956 |                        | 最高クオリティでも可逆系列よりサイズ小さい。 |
|   5   | 可逆圧縮      | -lossless -q 0           |    980.060 |                        |                                              |
|   6   | 可逆圧縮      | -lossless -q 75          |    961.738 | 可逆圧縮のデフォルト   |                                              |
|   7   | 可逆圧縮      | -lossless -q 100         |    955.326 |                        | 体感できるほど処理に時間がかかる             |
|   8   | ほぼ無損失    | -near_lossless 0         |    561.016 |                        | 一見、画像の劣化は感じられない。             |
|   9   | ほぼ無損失    | -near_lossless 60        |    696.416 | 典型的な値             | -qはデフォ75のよう                           |
|  10   | ほぼ無損失    | -near_lossless 100       |    961.738 | 前処理なし、デフォルト | -lossless -q 75 と同等                       |
|  11   | ほぼ無損失    | -near_lossless 60 -q 0   |    727.096 |                        |                                              |
|  12   | ほぼ無損失    | -near_lossless 60 -q 100 |    695.180 |                        | 体感できるほど処理に時間がかかる             |


### いくつか画像を見てみる
可逆圧縮はそのままとして、
#### 2.非可逆圧縮 [-q 0]
![]()
うへ。
#### 3.非可逆圧縮 [-q 75]
デフォルトです。
#### 4.非可逆圧縮 [-q 100]
デフォルトと違いはわからない。
#### 8.ほぼ無損失 [-near_lossless 0]
最低にしてみたけど劣化は感じられない。
サイズはそれほど小さくならないかな。


### まとめ
写真は可逆圧縮のデフォルトでいいんじゃなかろうか。

#### (圧縮前のbmp)
![](./input.bmp)


#### 非可逆圧縮
##### 品質0
```
-q 0
```
![](./output_q0.webp)


##### 品質75
非可逆圧縮のデフォルト
```
-q 75
```
![](./output_q75.webp)

##### 品質100
```
-q 100
```
![](./output_q100.webp)


#### 可逆圧縮
##### 品質0
```
-lossless -q 0
```
![](./output_lq0.webp)


##### 品質75
```
-lossless -q 75
```
![](./output_lq75.webp)
 可逆圧縮のデフォルト

##### 品質100
```
-lossless -q 100
```
![](./output_lq100.webp)

体感できるほど処理に時間がかかる
#### ほぼ無損失(品質75固定・無損失レベルを変動)
```
-near_lossless 0
```
![](./output_nl0.webp)


```
-near_lossless 60
```
![](./output_nl60.webp)
典型的な値
-qはデフォ75のよう
```
-near_lossless 100
```
![](./output_nl100.webp)
前処理なし、デフォルト

#### ほぼ無損失(損失レベル60固定・品質を変動)
##### 品質0
```
-near_lossless 60 -q 0
```
![](./output_nl60q0.webp)


##### 品質100
```
-near_lossless 60 -q 100
```
![](./output_nl60q100.webp)


### スクリーンショット


別途、可逆の場合は``-z``でプリセット(0:fast, ... , 9:slowest)で指定できる。、可逆の場合は``-m``というオプションもある。

## プリセット
``-preset <string>``でモードを指定できるようだ。
選べるのは、``default, photo, picture, drawing, icon, text``とのこと。
写真はフォト、絵はpicture、図形はdrawing、で、iconは何？文字はtextということかな。
スクショならdrawingかtextがいいのかな。
